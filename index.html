<script>
    // 1. ตรวจสอบให้มั่นใจว่า URL ลงท้ายด้วย /exec
    const scriptURL = 'ใส่_WEB_APP_URL_ที่นี่'; 

    const roomTypeSelect = document.getElementById('roomType');
    const depositDisplay = document.getElementById('depositDisplay');

    roomTypeSelect.addEventListener('change', (e) => {
        const prices = { 'VIP': 200, 'Meeting': 500 };
        const price = prices[e.target.value] || 0;
        depositDisplay.innerText = `${price} บาท`;
    });

    document.getElementById('bookingForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        Swal.fire({
            title: 'กำลังตรวจสอบสถานะห้อง...',
            allowOutsideClick: false,
            didOpen: () => { Swal.showLoading(); }
        });

        const formData = {
            date: document.getElementById('date').value,
            startTime: document.getElementById('startTime').value,
            endTime: document.getElementById('endTime').value,
            roomType: document.getElementById('roomType').value,
            note: document.getElementById('note').value,
            deposit: document.getElementById('roomType').value === 'VIP' ? 200 : 500
        };

        try {
            // ใช้เทคนิคการส่งแบบ Request ปกติ
            const response = await fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors', // ใช้ no-cors เพื่อข้ามปัญหา Redirect ของ Google
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });

            // เนื่องด้วยโหมด no-cors เราจะอ่าน JSON ไม่ได้ 
            // แต่ถ้า fetch สำเร็จ (ไม่พ่น Error) มักแปลว่าข้อมูลเข้าแล้ว
            Swal.fire({
                icon: 'success',
                title: 'ส่งคำขอจองสำเร็จ!',
                text: 'ระบบกำลังบันทึกข้อมูล กรุณารอเจ้าหน้าที่ยืนยัน หรือเช็กที่ Google Sheets',
                confirmButtonColor: '#4F46E5'
            });
            document.getElementById('bookingForm').reset();
            depositDisplay.innerText = '0 บาท';

        } catch (error) {
            Swal.fire({
                icon: 'error',
                title: 'เกิดข้อผิดพลาด',
                text: 'ไม่สามารถติดต่อเซิร์ฟเวอร์ได้ กรุณาลองใหม่ภายหลัง',
                confirmButtonColor: '#EF4444'
            });
        }
    });
</script>
